<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>IOC Checker</title>
</head>
<body>
    <h1>IOC Checker</h1>
    <textarea id="ioc-input" rows="10" cols="60" placeholder="Enter one IOC per line"></textarea><br />
    <button onclick="submitIOCs()">Submit</button>
    <div id="results"></div>
<script>
async function submitIOCs(){
    const raw = document.getElementById('ioc-input').value.trim();
    if(!raw) return;
    const iocs = raw.split(/\n+/).map(x=>x.trim()).filter(Boolean);
    const res = await fetch('/scan', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(iocs)});
    const data = await res.json();
    const container = document.getElementById('results');
    container.innerHTML = '';
    data.tasks.forEach(t => {
        const div = document.createElement('div');
        div.id = 'task-'+t.id;
        div.textContent = `${t.ioc} : queued`;
        container.appendChild(div);
        poll(t.id, div);
    });
}
async function poll(id, element){
    const res = await fetch(`/status/${id}`);
    const data = await res.json();
    if(data.status){
        element.textContent = `${data.ioc} : ${data.status}${data.result ? ' => '+JSON.stringify(data.result):''}`;
        if(data.status === 'queued' || data.status === 'processing'){
            setTimeout(()=>poll(id, element), 1000);
        }
    }
}
</script>
</body>
</html>
